# Overview

This is a simple container to create a secure WebDAV server.

# Quickstart

This is the minimum effort you need to expend to create a WebDAV server with this container. This is not an acceptable way to run it in production, because it:

* uses an autogenerated self-signed SSL certificate.
* runs with insecure, default credentials: username `admin`, password `admin`.
* doesn't create a volume or a mount for the `uploads` directory, so anything you upload will be deleted when the container is stopped.

```
docker run --rm -p 443:443 webdav
```

That's it. You should be able to connect at this URL: davs://localhost/uploads

# Usage

## Create a self-signed SSL certificate

First, you need to create a self-signed SSL cert. This will output unencrypted server.key and server.crt files in your current directory:
```
openssl req -days 365 -keyout server.key -new -newkey rsa:4096 -nodes -out server.crt -x509
```
Here's an example:
```
$ openssl req -days 365 -keyout server.key -new -newkey rsa:4096 -nodes -out server.crt -x509
Generating a RSA private key
..............................................................++++
........................................................................................................................++++
writing new private key to 'server.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:US
State or Province Name (full name) [Some-State]:California
Locality Name (eg, city) []:San Diego
Organization Name (eg, company) [Internet Widgits Pty Ltd]:DeDevSecOps
Organizational Unit Name (eg, section) []:.
Common Name (e.g. server FQDN or YOUR name) []:dedevsecops.com
Email Address []:
```

## Create admin user credentials

Next, you need to create credentials for the admin user that will have read-write access to the server. This will mount your currently directory and use the httpd Docker container's `htdigest` command to create the credentials. When you're done, you should see a new `user.passwd` file in your local directory.
```
docker run --rm -it -v "$PWD":/mnt httpd:2.4.46-alpine htdigest -c /mnt/user.passwd DAV-upload admin
```

## Create the uploads directory

And finally, you need to create an `uploads` directory, and give it the correct ownership. The `daemon` user and group used by the httpd Docker image are running as UID 2 and GID 2, so this directory needs to have those permissions to write new directories and files.

```
mkdir uploads
sudo chown 2:2 uploads
```

TODO: We should support Docker volumes too probably.

## Run the service

There are several ways to do this. You could:

* Run from the CLI using the docker command:
   ```
   docker run \
     --rm \
     -it \
     -v "$(pwd)/server.crt":/usr/local/apache2/conf/server.crt \
     -v "$(pwd)/server.key":/usr/local/apache2/conf/server.key \
     -v "$(pwd)/user.passwd":/usr/local/apache2/user.passwd \
     -v "$(pwd)/uploads":/usr/local/apache2/uploads \
     -p 443:443 \
     webdav
   ```
* Docker Compose:
   ```
   ```
* Kubernetes with Helm:
  ```
  ```

## Connect to the server

```
davs://localhost/uploads
```

### GNOME
### KDE
### Linux CLI
### Windows
### MacOS
### Android
### IOS
